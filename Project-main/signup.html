<div class="container" style="padding-top: 2rem;">
  <div class="card" style="max-width: 500px; margin: 0 auto;">
    <div class="card-header">
      <h1 class="card-title">Sign Up</h1>
      <p class="card-subtitle">Create your QuicReF account to get started</p>
    </div>
    <div class="card-content">
      <div id="signup-alert" class="alert alert-error mb-4 hidden"></div>
      
      <form id="signup-form">
        <div class="form-group">
          <label for="email" class="form-label">Email address</label>
          <input type="email" id="email" class="form-control" placeholder="your@email.com" required>
        </div>
        
        <div class="form-group">
          <label for="password" class="form-label">Password</label>
          <input type="password" id="password" class="form-control" placeholder="Choose a password (min. 6 characters)" required>
          <div class="form-help">Password must be at least 6 characters</div>
        </div>
        
        <div class="form-group">
          <label for="confirm-password" class="form-label">Confirm Password</label>
          <input type="password" id="confirm-password" class="form-control" placeholder="Confirm your password" required>
        </div>
        
        <div class="form-group">
          <label for="referral-code" class="form-label">Referral Code (Optional)</label>
          <input type="text" id="referral-code" class="form-control" placeholder="Enter referral code if you have one">
          <div class="form-help">Leave empty if you don't have a referral code</div>
        </div>
        
        <button type="submit" id="signup-button" class="btn btn-primary btn-block mb-3">
          Create Account
        </button>
        
        <p class="text-center">
          Already have an account? <a href="/login">Log in</a>
        </p>
      </form>
    </div>
  </div>
</div>

<script>
function initsignupPage() {
  document.title = "Sign Up - QuicReF";
  
  // Get form elements
  const signupForm = document.getElementById('signup-form');
  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const confirmPasswordInput = document.getElementById('confirm-password');
  const referralCodeInput = document.getElementById('referral-code');
  const signupButton = document.getElementById('signup-button');
  const signupAlert = document.getElementById('signup-alert');
  
  // Get referral code from URL if present
  const urlParams = new URLSearchParams(window.location.search);
  const referralFromUrl = urlParams.get('ref');
  if (referralFromUrl) {
    referralCodeInput.value = referralFromUrl;
  }
  
  // Add form submission handler
  signupForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // Clear previous errors
    signupAlert.classList.add('hidden');
    signupAlert.textContent = '';
    
    // Disable button during signup
    signupButton.disabled = true;
    signupButton.innerHTML = '<div class="loading-spinner" style="width: 20px; height: 20px; margin: 0 auto;"></div>';
    
    // Get form values
    const email = emailInput.value.trim();
    const password = passwordInput.value;
    const confirmPassword = confirmPasswordInput.value;
    const referralCode = referralCodeInput.value.trim();
    
    // Validate email
    if (!isValidEmail(email)) {
      showError('Please enter a valid email address.');
      return;
    }
    
    // Validate password
    if (password.length < 6) {
      showError('Password must be at least 6 characters long.');
      return;
    }
    
    // Validate password confirmation
    if (password !== confirmPassword) {
      showError('Passwords do not match.');
      return;
    }
    
    try {
      // Attempt signup
      const result = await Auth.register(email, password, referralCode || null);
      
      if (result.success) {
        // Show success message and redirect to homepage
        signupAlert.textContent = 'Account created successfully! Redirecting...';
        signupAlert.classList.remove('alert-error');
        signupAlert.classList.add('alert-success');
        signupAlert.classList.remove('hidden');
        
        // Redirect after short delay
        setTimeout(() => {
          Router.navigate('/');
        }, 1500);
      } else {
        // Show error
        showError(result.error || 'Failed to create account. Please try again.');
      }
    } catch (error) {
      console.error('Signup error:', error);
      showError('An unexpected error occurred. Please try again.');
    }
  });
  
  // Helper function to show error
  function showError(message) {
    signupButton.disabled = false;
    signupButton.textContent = 'Create Account';
    signupAlert.textContent = message;
    signupAlert.classList.add('alert-error');
    signupAlert.classList.remove('alert-success');
    signupAlert.classList.remove('hidden');
  }
  
  // Helper function to validate email
  function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }
}
</script>